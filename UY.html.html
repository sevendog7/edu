<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìœ ì—°ê·¼ë¬´ì ì›”ë³„ ìì²´ì ê²€í‘œ (2025.7. ê¸°ì¤€)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; }
        .score-cell { font-weight: bold; }
        .violation { color: #ef4444; } /* Red for violation */
        .safe { color: #10b981; } /* Green for 0 */
        select, input[type="text"], input[type="month"] { border: 1px solid #d1d5db; padding: 4px; border-radius: 4px; }
        input[type="text"] { padding: 6px; }
        select { width: 100%; }
        th, td { border: 1px solid #e5e7eb; padding: 6px 8px; text-align: center; vertical-align: middle; }
        th { background-color: #f3f4f6; font-weight: 600; font-size: 0.9rem; }
        tr:hover { background-color: #f9fafb; }
        /* Print styles */
        @media print {
            .no-print { display: none; }
            body { font-size: 10pt; }
            select { appearance: none; border: none; background: transparent; }
            input { border: none; background: transparent; }
        }
    </style>
</head>
<body class="bg-gray-50 p-4 md:p-8">

    <div class="max-w-7xl mx-auto bg-white shadow-lg rounded-lg overflow-hidden">
        <!-- Header -->
        <div class="bg-blue-600 p-6 text-white">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-4">
                <div>
                    <h1 class="text-2xl font-bold flex items-center gap-2">
                        ğŸ“… ì›”ë³„ ìœ ì—°ê·¼ë¬´ì ìì²´ì ê²€í‘œ
                    </h1>
                    <!-- Updated Subtitle -->
                    <p class="text-yellow-300 font-bold text-lg mt-1 bg-blue-800 bg-opacity-30 inline-block px-2 rounded">
                        (25.7.1.ì‹œí–‰) ìœ„ë°˜í•œ ë‚ ì˜ ë°ì´í„°ë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”.(ì§€ì—° ì¸ì‹, ë¯¸ì¸ì‹, ë‚˜ì´ìŠ¤ ë¯¸ê²°ì¬, ì¦ë¹™ ë¯¸ê²°ì¬ ë“±)
                    </p>
                </div>
                <!-- User Info Inputs -->
                <div class="flex gap-2 bg-blue-700 p-2 rounded-lg bg-opacity-50">
                    <input type="text" placeholder="ì†Œì†/ì§ê¸‰" class="text-black w-32 md:w-40 text-sm" aria-label="ì†Œì† ì§ê¸‰ ì…ë ¥">
                    <input type="text" placeholder="ì„±ëª…" class="text-black w-24 md:w-32 text-sm" aria-label="ì„±ëª… ì…ë ¥">
                </div>
            </div>
            
            <div class="flex justify-end no-print space-x-2">
                <button onclick="resetTable()" class="bg-blue-500 hover:bg-blue-400 text-white px-4 py-2 rounded text-sm transition shadow">ì´ˆê¸°í™”</button>
                <button onclick="downloadExcel()" class="bg-white text-blue-600 hover:bg-gray-100 px-4 py-2 rounded text-sm font-bold transition flex items-center gap-2 shadow">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                    </svg>
                    ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
                </button>
            </div>
        </div>

        <!-- Controls -->
        <div class="p-4 bg-gray-100 border-b no-print">
            <div class="flex flex-wrap items-center gap-2">
                <label class="font-bold text-gray-700">ëŒ€ìƒì›” ì„ íƒ:</label>
                <input type="month" id="monthPicker" class="border p-2 rounded w-40 text-black" onchange="generateRows()">
                <div class="flex flex-col md:flex-row md:items-center text-sm ml-2">
                    <span class="text-gray-500">* ì›”ì„ ë³€ê²½í•˜ë©´ í‘œê°€ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.</span>
                    <span class="text-red-600 font-bold md:ml-2">â€» ë°˜ë“œì‹œ ì›”ë³„ë°ì´í„°ë¥¼ ë‹¤ìš´ë¡œë“œ í›„ ë‹¤ìŒì›”ì„ ì ê²€í•´ì£¼ì„¸ìš”.</span>
                </div>
            </div>
        </div>

        <!-- Table -->
        <div class="overflow-x-auto p-4">
            <table class="w-full text-sm" id="checkListTable">
                <thead>
                    <tr>
                        <th class="w-16">ë‚ ì§œ</th>
                        <th class="w-16">êµ¬ë¶„</th>
                        <th class="w-24">ì‹¤ì œ ìƒí™©</th>
                        <th class="w-32">ì§€ë¬¸ì¸ì‹</th>
                        <th class="w-32">ì¦ë¹™(í™•ì¸ì„œ)<br>ë‚´ë¶€ê²°ì¬</th>
                        <th class="w-32">ë‚˜ì´ìŠ¤<br>(ì§€ê°/ì¡°í‡´)</th>
                        <th class="w-20">ìœ„ë°˜ì ìˆ˜</th>
                        <th>ë¹„ê³  (ìë™ íŒì •)</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Rows will be generated by JS -->
                </tbody>
                <tfoot>
                    <tr class="bg-gray-100 font-bold">
                        <td colspan="6" class="text-right pr-4 text-base">ì›”ê°„ ìœ„ë°˜ì ìˆ˜ í•©ê³„ (A)</td>
                        <td id="totalScore" class="text-lg text-red-600">0</td>
                        <td></td>
                    </tr>
                    <tr class="bg-blue-50 font-bold border-t-2 border-blue-200">
                        <td colspan="6" class="text-right pr-4 text-base text-blue-800">ìµœì¢… ì œì¬ ì ìˆ˜ (A - 5ì )</td>
                        <td id="finalPenalty" class="text-lg text-blue-700">0</td>
                        <td class="text-left text-xs font-normal text-gray-600 pl-2 leading-relaxed">
                            * 5ì  ê³µì œ í›„ ë‚¨ì€ ì ìˆ˜<br>
                            * 1ì ë‹¹ 1ì£¼ì¼ ìœ ì—°ê·¼ë¬´ ì œí•œ<br>
                            <span class="text-blue-700 font-semibold">â€» 1ì£¼ì¼ì—ëŠ” ì£¼ë§ì„ í¬í•¨í•˜ì§€ ì•Šê³ , ì‹¤ ê·¼ë¬´ì¼ì˜ í•©ì„ ê¸°ì¤€ìœ¼ë¡œ í•¨(ì˜ˆ: 7ì¼ ì œí•œì´ë©´ ì£¼ë§í¬í•¨ 9ì¼ì„)</span>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <!-- Logic Reference -->
        <div class="p-6 bg-gray-50 border-t">
            <h3 class="font-bold text-lg mb-4 text-gray-800">ğŸ“Œ ìœ„ë°˜ì ìˆ˜ ì‚°ì • ê·¼ê±° (2025.7.1. ì‹œí–‰)</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-sm">
                <!-- Left: Normal Status -->
                <div class="bg-white p-4 rounded border">
                    <h4 class="font-bold text-blue-600 mb-2 border-b pb-1">1. ì •ìƒ ì¶œí‡´ê·¼ (ì‹œê°„ ì¤€ìˆ˜)</h4>
                    <ul class="space-y-2">
                        <li>
                            <span class="font-bold text-gray-700">âœ… ì§€ë¬¸ ì •ìƒ ì¸ì‹:</span>
                            <span class="float-right font-bold text-green-600">0ì </span>
                        </li>
                        <li>
                            <span class="font-bold text-gray-700">âš ï¸ ì§€ë¬¸ ì§€ì—° ì¸ì‹ (ì¶œê·¼ë§Œ í•´ë‹¹):</span>
                            <div class="pl-2 text-xs text-gray-600">
                                - ë‚˜ì´ìŠ¤(ì§€ê°) ê²°ì¬ ì‹œ: <span class="font-bold text-green-600">0ì </span><br>
                                - ë‚˜ì´ìŠ¤ ë¯¸ê²°ì¬ ì‹œ: <span class="font-bold text-red-500">1ì </span>
                            </div>
                        </li>
                        <li class="bg-red-50 p-1 rounded">
                            <span class="font-bold text-gray-700">ğŸš« ì§€ë¬¸ ë¯¸ì¸ì‹:</span>
                            <div class="pl-2 text-xs text-gray-600">
                                - ì¦ë¹™(í™•ì¸ì„œ) ê²°ì¬ ì‹œ: <span class="font-bold text-red-500">1ì </span> (ê¸°ë³¸ ìœ„ë°˜)<br>
                                - ì¦ë¹™ ë¯¸ê²°ì¬ ì‹œ: <span class="font-bold text-red-500">3ì </span> (ê¸°ë³¸1 + ë¯¸ë¹„2)
                            </div>
                        </li>
                    </ul>
                </div>

                <!-- Right: Late/Early Status -->
                <div class="bg-white p-4 rounded border">
                    <h4 class="font-bold text-orange-600 mb-2 border-b pb-1">2. ì§€ê° ì¶œê·¼ / ì¡°ê¸° í‡´ê·¼</h4>
                    <ul class="space-y-2">
                        <li>
                            <span class="font-bold text-gray-700">âœ… ì§€ë¬¸ ì¸ì‹ (ì‹œê°„ ë¶ˆë¬¸):</span>
                            <div class="pl-2 text-xs text-gray-600">
                                - ë‚˜ì´ìŠ¤(ì§€ê°/ì¡°í‡´) ê²°ì¬ ì‹œ: <span class="font-bold text-green-600">0ì </span><br>
                                - ë‚˜ì´ìŠ¤ ë¯¸ê²°ì¬ ì‹œ: <span class="font-bold text-red-500">1ì </span>
                            </div>
                        </li>
                        <li>
                            <span class="font-bold text-gray-700">ğŸš« ì§€ë¬¸ ë¯¸ì¸ì‹ (ë³µí•© ìœ„ë°˜):</span>
                            <div class="pl-2 text-xs text-gray-600 mt-1">
                                <span class="block">â‘  ì¦ë¹™O + ë‚˜ì´ìŠ¤O : <span class="font-bold text-red-500">1ì </span> (ê¸°ë³¸ìœ„ë°˜)</span>
                                <span class="block">â‘¡ ì¦ë¹™O + ë‚˜ì´ìŠ¤X : <span class="font-bold text-red-500">2ì </span> (ê¸°ë³¸1+ë‚˜ì´ìŠ¤1)</span>
                                <span class="block">â‘¢ ì¦ë¹™X + ë‚˜ì´ìŠ¤O : <span class="font-bold text-red-500">3ì </span> (ê¸°ë³¸1+ì¦ë¹™2)</span>
                                <span class="block">â‘£ ì¦ë¹™X + ë‚˜ì´ìŠ¤X : <span class="font-bold text-red-500">4ì </span> (ì „ì²´ ë¯¸ë¹„)</span>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="mt-4 text-xs text-gray-500 bg-yellow-50 p-2 rounded">
                â€» <strong>ì§€ë¬¸ ë¯¸ì¸ì‹ 1ì </strong>: ì •ìƒ ì¶œê·¼í–ˆë”ë¼ë„ ì§€ë¬¸ì„ ì°ì§€ ì•Šìœ¼ë©´ ì¶œí‡´ê·¼ í™•ì¸ ë¶ˆê°€ë¡œ ê¸°ë³¸ 1ì  ë¶€ê³¼ë©ë‹ˆë‹¤.<br>
                â€» <strong>ì›”ë³„ ê³µì œ</strong>: ì›”ê°„ ìœ„ë°˜ì ìˆ˜ í•©ê³„ì—ì„œ <strong>5ì </strong>ì„ ì°¨ê°í•©ë‹ˆë‹¤. (ì˜ˆ: 6ì  ìœ„ë°˜ ì‹œ 1ì  ì ìš© â†’ 1ì£¼ì¼ ì œí•œ)<br>
                â€» <strong>ì¦ë¹™(í™•ì¸ì„œ)</strong>: 'ìœ ì—°ê·¼ë¬´ ì¶œ/í‡´ê·¼ í™•ì¸ì„œ' ë‚´ë¶€ê²°ì¬ë¥¼ ì˜ë¯¸í•¨
            </div>
        </div>
    </div>

    <script>
        // Initialize
        const today = new Date();
        document.getElementById('monthPicker').value = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;
        
        // Data Options
        const STATUSES = ['ì •ìƒ (ì‹œê°„ì¤€ìˆ˜)', 'ì§€ê°/ì¡°í‡´'];
        const FINGERPRINTS = ['ì •ìƒ ì¸ì‹', 'ì§€ì—° ì¸ì‹ (ëŠ¦ê²Œ ì°ìŒ)', 'ë¯¸ì¸ì‹'];
        const PROOFS = ['í•´ë‹¹ì—†ìŒ', 'ê²°ì¬ì™„ë£Œ', 'ë¯¸ê²°ì¬'];
        const NICES = ['í•´ë‹¹ì—†ìŒ', 'ê²°ì¬ì™„ë£Œ', 'ë¯¸ê²°ì¬'];

        function generateRows() {
            const monthVal = document.getElementById('monthPicker').value;
            const [year, month] = monthVal.split('-');
            const daysInMonth = new Date(year, month, 0).getDate();
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            for (let day = 1; day <= daysInMonth; day++) {
                createDailyRows(tbody, year, month, day);
            }
            calculateTotal();
        }

        function createDailyRows(tbody, year, month, day) {
            // Row 1: Arrival (contains Date cell with rowspan)
            const trArrival = document.createElement('tr');
            trArrival.classList.add('border-t-2', 'border-gray-100', 'day-row-start');
            trArrival.dataset.day = day;
            
            // Helper for Selects
            const makeSelect = (options, name, onchange, defaultType) => {
                let html = `<select onchange="${onchange}" class="${name}-select text-sm h-full">`;
                options.forEach(opt => {
                    let selected = '';
                    if (name === 'proof' || name === 'nice') {
                        if (opt === 'í•´ë‹¹ì—†ìŒ') selected = 'selected';
                    } else if (name === 'fingerprint' && opt === 'ì •ìƒ ì¸ì‹') {
                        selected = 'selected';
                    } else if (name === 'status' && opt.startsWith('ì •ìƒ')) {
                        selected = 'selected';
                    }
                    html += `<option value="${opt}" ${selected}>${opt}</option>`;
                });
                html += `</select>`;
                return html;
            };

            // Date Column (Rowspan 2)
            trArrival.innerHTML = `
                <td rowspan="2" class="date-cell text-center font-bold text-gray-700 bg-gray-50 border-b-2 border-gray-200">${day}ì¼</td>
                <td class="bg-blue-50 font-medium text-center text-blue-800">ì¶œê·¼
                    <input type="hidden" class="type-val" value="ì¶œê·¼">
                </td>
                <td>${makeSelect(STATUSES, 'status', 'updateRow(this)')}</td>
                <td>${makeSelect(FINGERPRINTS, 'fingerprint', 'updateRow(this)')}</td>
                <td>${makeSelect(PROOFS, 'proof', 'updateRow(this)')}</td>
                <td>${makeSelect(NICES, 'nice', 'updateRow(this)')}</td>
                <td class="score-cell text-lg text-center safe">0</td>
                <td class="note-cell text-xs text-gray-500 text-left pl-2">-</td>
            `;

            // Row 2: Departure (No Date cell)
            const trDeparture = document.createElement('tr');
            trDeparture.classList.add('day-row-end');
            trDeparture.dataset.day = day;
            
            trDeparture.innerHTML = `
                <td class="bg-orange-50 font-medium text-center text-orange-800">í‡´ê·¼
                    <input type="hidden" class="type-val" value="í‡´ê·¼">
                </td>
                <td>${makeSelect(STATUSES, 'status', 'updateRow(this)')}</td>
                <td>${makeSelect(FINGERPRINTS, 'fingerprint', 'updateRow(this)')}</td>
                <td>${makeSelect(PROOFS, 'proof', 'updateRow(this)')}</td>
                <td>${makeSelect(NICES, 'nice', 'updateRow(this)')}</td>
                <td class="score-cell text-lg text-center safe">0</td>
                <td class="note-cell text-xs text-gray-500 text-left pl-2">-</td>
            `;

            tbody.appendChild(trArrival);
            tbody.appendChild(trDeparture);
        }

        function updateRow(element) {
            const row = element.closest('tr');
            const type = row.querySelector('.type-val').value;
            const status = row.querySelector('.status-select').value;
            const fingerprint = row.querySelector('.fingerprint-select').value;
            const proof = row.querySelector('.proof-select').value;
            const nice = row.querySelector('.nice-select').value;
            
            const result = calculateScore(type, status, fingerprint, proof, nice);
            
            // Update Score Cell
            const scoreCell = row.querySelector('.score-cell');
            scoreCell.textContent = result.score;
            if (result.score > 0) {
                scoreCell.classList.remove('safe');
                scoreCell.classList.add('violation');
            } else {
                scoreCell.classList.remove('violation');
                scoreCell.classList.add('safe');
            }

            // Update Note Cell
            row.querySelector('.note-cell').textContent = result.note;

            // Auto-disable irrelevant fields for UX
            toggleFields(row, type, status, fingerprint);

            calculateTotal();
        }

        function toggleFields(row, type, status, fingerprint) {
            const proofSelect = row.querySelector('.proof-select');
            const niceSelect = row.querySelector('.nice-select');
            
            // Reset colors
            proofSelect.style.backgroundColor = '';
            niceSelect.style.backgroundColor = '';
            
            // Logic for visual cues (Optional)
            if (fingerprint === 'ë¯¸ì¸ì‹' || (fingerprint.includes('ì§€ì—°') && type === 'ì¶œê·¼') || status.includes('ì§€ê°') || status.includes('ì¡°í‡´')) {
                // Something is wrong
            }
        }

        function calculateScore(type, status, fingerprint, proof, nice) {
            let score = 0;
            let note = "ì ì •";

            const isNormal = status.startsWith('ì •ìƒ');
            const isTagged = fingerprint === 'ì •ìƒ ì¸ì‹';
            const isLateTag = fingerprint.startsWith('ì§€ì—°');
            const isNoTag = fingerprint === 'ë¯¸ì¸ì‹';
            
            const proofDone = proof === 'ê²°ì¬ì™„ë£Œ';
            const niceDone = nice === 'ê²°ì¬ì™„ë£Œ';
            
            // 1. ì •ìƒ ìƒí™© (ì‹œê°„ ì¤€ìˆ˜)
            if (isNormal) {
                if (isTagged) {
                    score = 0;
                    note = "ì •ìƒ ì²˜ë¦¬";
                } else if (isLateTag) {
                    // ì§€ì—° ì¸ì‹ (ì¶œê·¼ë§Œ í•´ë‹¹, í‡´ê·¼ì€ ì‹œê°„ ì§€ë‚˜ì„œ ì°ì–´ë„ ì •ìƒ)
                    if (type === 'ì¶œê·¼') {
                        if (niceDone) {
                            score = 0;
                            note = "ì§€ì—°ì¸ì‹ ì†Œëª…(ë‚˜ì´ìŠ¤) ì™„ë£Œ";
                        } else {
                            score = 1;
                            note = "ì§€ì—°ì¸ì‹+ë‚˜ì´ìŠ¤ ë¯¸ì¡°ì¹˜";
                        }
                    } else {
                        // í‡´ê·¼ì€ ëŠ¦ê²Œ ì°ì–´ë„ ë¬¸ì œ ì—†ìŒ
                        score = 0;
                        note = "ì •ìƒ í‡´ê·¼ (ì§€ë¬¸ì¸ì‹)";
                    }
                } else if (isNoTag) {
                    // ì§€ë¬¸ ë¯¸ì¸ì‹ì€ ê¸°ë³¸ 1ì  ë¶€ê³¼
                    if (proofDone) {
                        score = 1; // ê¸°ë³¸ ìœ„ë°˜ 1ì 
                        note = "ì§€ë¬¸ ë¯¸ì¸ì‹(1) + ì†Œëª…ì™„ë£Œ";
                    } else {
                        score = 3; // ê¸°ë³¸(1) + ì¦ë¹™ ë¯¸ë¹„(2)
                        note = "ì§€ë¬¸ ë¯¸ì¸ì‹(1) + ì¦ë¹™ ë¯¸ë¹„(2)";
                    }
                }
            } 
            // 2. ë¹„ì •ìƒ ìƒí™© (ì§€ê°/ì¡°í‡´)
            else {
                // ì§€ë¬¸ ì°ì—ˆìœ¼ë‚˜ ì§€ê°/ì¡°í‡´ì¸ ê²½ìš°
                if (isTagged || isLateTag) { 
                    if (niceDone) {
                        score = 0;
                        note = "ì§€ê°/ì¡°í‡´ ë‚˜ì´ìŠ¤ ì²˜ë¦¬ ì™„ë£Œ";
                    } else {
                        score = 1;
                        note = "ë‚˜ì´ìŠ¤ ë¯¸ìƒì‹  (1ì )";
                    }
                } 
                // ì§€ë¬¸ë„ ì•ˆ ì°ê³  ì§€ê°/ì¡°í‡´ì¸ ê²½ìš° (ë³µí•© ìœ„ë°˜)
                else if (isNoTag) {
                    // ê²½ìš°ì˜ ìˆ˜ 4ê°€ì§€
                    if (proofDone && niceDone) {
                        score = 1; // ê¸°ë³¸ ìœ„ë°˜(ì§€ë¬¸ ë¯¸ì¸ì‹) ì ìˆ˜ë§Œ ë¶€ê³¼
                        note = "ì§€ë¬¸ ë¯¸ì¸ì‹ ìœ„ë°˜ (1ì )";
                    } else if (proofDone && !niceDone) {
                        score = 2; // ê¸°ë³¸(1) + ë‚˜ì´ìŠ¤ ë¯¸ë¹„(1)
                        note = "ë¯¸ì¸ì‹(1)+ë‚˜ì´ìŠ¤ ë¯¸ë¹„(1)";
                    } else if (!proofDone && niceDone) {
                        score = 3; // ê¸°ë³¸(1) + ì¦ë¹™ ë¯¸ë¹„(2)
                        note = "ë¯¸ì¸ì‹(1)+ì¦ë¹™ ë¯¸ë¹„(2)";
                    } else {
                        score = 4; // ê¸°ë³¸(1) + ì¦ë¹™ ë¯¸ë¹„(2) + ë‚˜ì´ìŠ¤ ë¯¸ë¹„(1)
                        note = "ì „ì²´ ë¯¸ì¡°ì¹˜ (4ì )";
                    }
                }
            }

            return { score, note };
        }

        function calculateTotal() {
            let total = 0;
            const scores = document.querySelectorAll('.score-cell');
            scores.forEach(cell => {
                total += parseInt(cell.textContent || 0);
            });
            
            document.getElementById('totalScore').textContent = total + "ì ";
            
            // ê³µì œ 5ì  ì ìš©
            let final = total - 5;
            if (final < 0) final = 0;
            document.getElementById('finalPenalty').textContent = final + "ì ";
        }

        function resetTable() {
            if(confirm('ì‘ì„± ë‚´ìš©ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                generateRows();
            }
        }

        function downloadExcel() {
            const tbody = document.getElementById('tableBody');
            const allRows = tbody.querySelectorAll('tr');
            let tableHTML = `<thead>${document.querySelector('thead').innerHTML}</thead><tbody>`;
            
            let hasContent = false;
            let currentDayStartRow = null;
            
            // We need to iterate in pairs (Arrival + Departure) for each day
            for (let i = 0; i < allRows.length; i += 2) {
                const rowArrival = allRows[i];
                const rowDeparture = allRows[i+1];
                
                // Check if meaningful data exists in either row
                // Meaningful = Status not 'ì •ìƒ (ì‹œê°„ì¤€ìˆ˜)' OR Fingerprint not 'ì •ìƒ ì¸ì‹' OR Score > 0
                const isMeaningful = (row) => {
                    const status = row.querySelector('.status-select').value;
                    const fingerprint = row.querySelector('.fingerprint-select').value;
                    const score = parseInt(row.querySelector('.score-cell').textContent);
                    return status !== 'ì •ìƒ (ì‹œê°„ì¤€ìˆ˜)' || fingerprint !== 'ì •ìƒ ì¸ì‹' || score > 0;
                };

                const arrivalImportant = isMeaningful(rowArrival);
                const departureImportant = isMeaningful(rowDeparture);

                if (arrivalImportant || departureImportant) {
                    hasContent = true;
                    // Add both rows to preserve structure, or logic to merge
                    // Simplest approach: Add both rows if *any* part of the day is important
                    // to keep the date rowspan correct.
                    
                    // Process Arrival Row
                    tableHTML += '<tr>';
                    const aCells = rowArrival.querySelectorAll('td');
                    aCells.forEach((cell, idx) => {
                         // Copy attributes like rowspan
                        let tdAttr = '';
                        if (cell.hasAttribute('rowspan')) tdAttr = `rowspan="${cell.getAttribute('rowspan')}"`;
                        
                        const select = cell.querySelector('select');
                        const input = cell.querySelector('input:not([type="hidden"])');
                        let text = select ? select.value : (input ? input.value : cell.innerText);
                        
                        let style = 'text-align:center; vertical-align:middle;';
                        if (text === 'ì¶œê·¼') style += 'background-color:#eff6ff; color:#1e40af;';
                        else if (cell.classList.contains('score-cell') && text !== '0') style += 'color:red; font-weight:bold;';
                        
                        tableHTML += `<td ${tdAttr} style="${style}">${text}</td>`;
                    });
                    tableHTML += '</tr>';

                    // Process Departure Row
                    tableHTML += '<tr>';
                    const dCells = rowDeparture.querySelectorAll('td');
                    dCells.forEach((cell, idx) => {
                        const select = cell.querySelector('select');
                        const input = cell.querySelector('input:not([type="hidden"])');
                        let text = select ? select.value : (input ? input.value : cell.innerText);
                        
                        let style = 'text-align:center; vertical-align:middle;';
                        if (text === 'í‡´ê·¼') style += 'background-color:#fff7ed; color:#9a3412;';
                        else if (cell.classList.contains('score-cell') && text !== '0') style += 'color:red; font-weight:bold;';
                        
                        tableHTML += `<td style="${style}">${text}</td>`;
                    });
                    tableHTML += '</tr>';
                }
            }
            
            if (!hasContent) {
                // If nothing was important, maybe show a message row or just header
                tableHTML += '<tr><td colspan="8" style="text-align:center; padding:10px;">ìœ„ë°˜ ë‚´ì—­ì´ ì—†ê±°ë‚˜ ì…ë ¥ëœ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            }

            tableHTML += '</tbody>';
            
            // User Inputs
            const inputs = document.querySelectorAll('.bg-blue-600 input');
            const userInfo = `
                <tr><td colspan="8" style="background-color:#2563eb; color:white; font-size:1.2em; font-weight:bold; text-align:center;">
                    ì›”ë³„ ìœ ì—°ê·¼ë¬´ì ìì²´ì ê²€í‘œ (${document.getElementById('monthPicker').value})
                </td></tr>
                <tr>
                    <td colspan="2" style="font-weight:bold; background-color:#e5e7eb;">ì†Œì†/ì§ê¸‰</td>
                    <td colspan="2">${inputs[0].value}</td>
                    <td colspan="2" style="font-weight:bold; background-color:#e5e7eb;">ì„±ëª…</td>
                    <td colspan="2">${inputs[1].value}</td>
                </tr>
            `;

            const footer = `
                <tr></tr>
                <tr>
                    <td colspan="6" style="text-align:right; font-weight:bold;">ì›”ê°„ ìœ„ë°˜ì ìˆ˜ í•©ê³„</td>
                    <td style="color:red; font-weight:bold; text-align:center;">${document.getElementById('totalScore').textContent}</td>
                    <td></td>
                </tr>
                <tr>
                    <td colspan="6" style="text-align:right; font-weight:bold; color:blue;">ìµœì¢… ì œì¬ ì ìˆ˜ (5ì  ê³µì œ)</td>
                    <td style="color:blue; font-weight:bold; text-align:center; font-size:1.2em;">${document.getElementById('finalPenalty').textContent}</td>
                    <td style="font-size:0.8em; color:gray;">* 1ì ë‹¹ 1ì£¼ì¼ ìœ ì—°ê·¼ë¬´ ì œí•œ (ì£¼ë§ ë¯¸í¬í•¨, ì‹¤ê·¼ë¬´ì¼ ê¸°ì¤€)</td>
                </tr>
            `;

            const html = `
            <html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">
            <head><meta charset="utf-8"></head>
            <body>
                <table border="1" style="border-collapse: collapse; width: 100%;">
                    ${userInfo}
                    ${tableHTML}
                    ${footer}
                </table>
            </body></html>`;

            const blob = new Blob([html], { type: 'application/vnd.ms-excel' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ìœ ì—°ê·¼ë¬´_ìì²´ì ê²€í‘œ_${document.getElementById('monthPicker').value}_${inputs[1].value || 'ì´ë¦„ë¯¸ì…ë ¥'}.xls`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Initial Load
        generateRows();
    </script>
</body>
</html>